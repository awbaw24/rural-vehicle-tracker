<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë†ì–´ì´Œ ì´ˆì •ë°€ ì°¨ëŸ‰ ì¶”ì  ì‹œìŠ¤í…œ</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.4); }
        70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
        100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
      }
      
      .tracking-dot {
        animation: pulse 2s infinite;
      }
      
      .location-card {
        background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
        border: 2px solid #0ea5e9;
      }

      .address-box {
        background: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
        border: 2px solid #22c55e;
      }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef } = React;

      function RuralVehicleTracker() {
        const [isTracking, setIsTracking] = useState(false);
        
        const [position, setPosition] = useState({
          latitude: null,
          longitude: null,
          timestamp: null,
          accuracy: null,
          error: null,
          address: null,
          buildingInfo: null, // ê±´ë¬¼ ì •ë³´ ë³„ë„ ì €ì¥
          addressLoading: false,
          publicDataAvailable: false // í–¥í›„ ê³µê³µë°ì´í„° ì—°ë™ ì—¬ë¶€
        });

        const [watchId, setWatchId] = useState(null);
        const [locationHistory, setLocationHistory] = useState([]);
        const [isOnline, setIsOnline] = useState(navigator.onLine);
        const [vehicleId, setVehicleId] = useState('');
        const [trackingStartTime, setTrackingStartTime] = useState(null);

        // í•œêµ­ í–‰ì •êµ¬ì—­ ì²´ê³„ì— ë§ëŠ” ì´ˆì •ë°€ ì£¼ì†Œ ë³€í™˜ í•¨ìˆ˜
        const getAddressFromCoordinates = async (lat, lng) => {
          try {
            setPosition(prev => ({...prev, addressLoading: true}));
            
            // OpenStreetMap Nominatim API (ìµœëŒ€ ì •ë°€ë„ë¡œ í•œêµ­ ì£¼ì†Œ ì²´ê³„ ìš”ì²­)
            const response = await fetch(
              `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&accept-language=ko&addressdetails=1&zoom=19&extratags=1`
            );
            
            if (response.ok) {
              const data = await response.json();
              console.log('ì£¼ì†Œ ì›ë³¸ ë°ì´í„°:', data); // ë””ë²„ê¹…ìš©
              
              let koreanAddress = '';
              let buildingInfo = '';
              
              if (data.address) {
                const addr = data.address;
                const addressParts = [];
                
                // 1. ì‹œ/ë„ (state/province)
                if (addr.state || addr.province) {
                  addressParts.push(addr.state || addr.province);
                }
                
                // 2. ì‹œ/êµ°/êµ¬ (city/county)
                if (addr.city) {
                  addressParts.push(addr.city);
                } else if (addr.county) {
                  addressParts.push(addr.county);
                } else if (addr.city_district) {
                  addressParts.push(addr.city_district);
                }
                
                // 3. ì/ë©´/ë™ (town/municipality)
                if (addr.town) {
                  addressParts.push(addr.town);
                } else if (addr.municipality) {
                  addressParts.push(addr.municipality);
                } else if (addr.suburb && addr.suburb.includes('ë™')) {
                  addressParts.push(addr.suburb);
                }
                
                // 4. ë¦¬/ë™ (village/neighbourhood)
                if (addr.village) {
                  addressParts.push(addr.village);
                } else if (addr.hamlet) {
                  addressParts.push(addr.hamlet);
                } else if (addr.neighbourhood && !addr.neighbourhood.includes('ë™')) {
                  addressParts.push(addr.neighbourhood);
                }
                
                // 5. ë²ˆì§€-í˜¸ (house_number with unit)
                if (addr.house_number) {
                  let addressNumber = '';
                  
                  // ë²ˆì§€-í˜¸ í˜•ì‹ ì²˜ë¦¬
                  if (addr.house_number.includes('-')) {
                    const [mainNumber, subNumber] = addr.house_number.split('-');
                    addressNumber = `${mainNumber}-${subNumber}í˜¸`;
                  } else {
                    addressNumber = `${addr.house_number}ë²ˆì§€`;
                    
                    // í˜¸ìˆ˜ê°€ ë³„ë„ë¡œ ìˆëŠ” ê²½ìš°
                    if (addr.unit || addr.apt || addr.suite) {
                      addressNumber = `${addr.house_number}-${addr.unit || addr.apt || addr.suite}í˜¸`;
                    }
                    
                    // postcodeë‚˜ ë‹¤ë¥¸ ì •ë³´ì—ì„œ í˜¸ìˆ˜ ì¶”ì¶œ ì‹œë„
                    if (data.extratags?.['addr:housename'] || data.extratags?.['addr:unit']) {
                      const unit = data.extratags['addr:housename'] || data.extratags['addr:unit'];
                      if (unit && unit.match(/\d+/)) {
                        addressNumber = `${addr.house_number}-${unit}í˜¸`;
                      }
                    }
                  }
                  
                  if (addressNumber) {
                    addressParts.push(addressNumber);
                  }
                }
                
                // 6. ê±´ë¬¼ëª… ìˆ˜ì§‘ (amenity, building, shop ë“±)
                const buildingNames = [];
                
                // POIë‚˜ ì‹œì„¤ëª…ì—ì„œ ê±´ë¬¼ëª… ì¶”ì¶œ
                if (data.display_name && data.category) {
                  const firstPart = data.display_name.split(',')[0].trim();
                  if (firstPart && !firstPart.match(/^\d/) && firstPart.length < 30) {
                    // í•œêµ­ì–´ ê±´ë¬¼ëª…ì¸ ê²½ìš°ë§Œ
                    if (firstPart.match(/[ê°€-í£]/)) {
                      buildingNames.push(firstPart);
                    }
                  }
                }
                
                // amenity (ì‹œì„¤)
                if (addr.amenity) {
                  const amenityKorean = {
                    'restaurant': 'ìŒì‹ì ',
                    'cafe': 'ì¹´í˜',
                    'school': 'í•™êµ',
                    'hospital': 'ë³‘ì›',
                    'clinic': 'ì˜ì›',
                    'bank': 'ì€í–‰',
                    'post_office': 'ìš°ì²´êµ­',
                    'pharmacy': 'ì•½êµ­',
                    'supermarket': 'ëŒ€í˜•ë§ˆíŠ¸',
                    'convenience': 'í¸ì˜ì ',
                    'gas_station': 'ì£¼ìœ ì†Œ',
                    'parking': 'ì£¼ì°¨ì¥',
                    'library': 'ë„ì„œê´€',
                    'town_hall': 'ì£¼ë¯¼ì„¼í„°',
                    'community_centre': 'ì»¤ë®¤ë‹ˆí‹°ì„¼í„°',
                    'fire_station': 'ì†Œë°©ì„œ',
                    'police': 'ê²½ì°°ì„œ',
                    'marketplace': 'ì‹œì¥'
                  };
                  
                  const koreanAmenity = amenityKorean[addr.amenity] || addr.amenity;
                  if (!buildingNames.includes(koreanAmenity)) {
                    buildingNames.push(koreanAmenity);
                  }
                }
                
                // building ì •ë³´
                if (addr.building && !buildingNames.includes(addr.building)) {
                  buildingNames.push(addr.building);
                }
                
                // shop ì •ë³´
                if (addr.shop) {
                  const shopKorean = {
                    'supermarket': 'ìŠˆí¼ë§ˆì¼“',
                    'convenience': 'í¸ì˜ì ',
                    'clothes': 'ì˜ë¥˜ë§¤ì¥',
                    'electronics': 'ì „ìì œí’ˆì ',
                    'hardware': 'ì² ë¬¼ì ',
                    'bakery': 'ë¹µì§‘',
                    'butcher': 'ì •ìœ¡ì ',
                    'hairdresser': 'ë¯¸ìš©ì‹¤',
                    'beauty': 'ë¯¸ìš©ì‹¤',
                    'books': 'ì„œì ',
                    'gift': 'ì„ ë¬¼ê°€ê²Œ'
                  };
                  
                  const koreanShop = shopKorean[addr.shop] || addr.shop;
                  if (!buildingNames.includes(koreanShop)) {
                    buildingNames.push(koreanShop);
                  }
                }
                
                // extratagsì—ì„œ ì¶”ê°€ ì •ë³´
                if (data.extratags) {
                  if (data.extratags.name && !buildingNames.includes(data.extratags.name)) {
                    buildingNames.push(data.extratags.name);
                  }
                  
                  if (data.extratags['name:ko'] && !buildingNames.includes(data.extratags['name:ko'])) {
                    buildingNames.push(data.extratags['name:ko']);
                  }
                }
                
                // ì¸µìˆ˜ ì •ë³´ ì¶”ê°€
                if (addr.level || data.extratags?.level) {
                  const level = addr.level || data.extratags.level;
                  if (level.includes('-') || level.includes('B') || level < 0) {
                    buildingNames.push(`ì§€í•˜${Math.abs(level)}ì¸µ`);
                  } else if (level !== '0' && level !== '1') {
                    buildingNames.push(`${level}ì¸µ`);
                  }
                }
                
                // ìµœì¢… ì£¼ì†Œ êµ¬ì„±
                koreanAddress = addressParts.join(' ');
                buildingInfo = buildingNames.length > 0 ? buildingNames.join(' ') : '';
                
                // ê±´ë¬¼ ì •ë³´ê°€ ìˆìœ¼ë©´ ì£¼ì†Œì— ì¶”ê°€
                if (buildingInfo) {
                  koreanAddress += ` ${buildingInfo}`;
                }
                
                // ìš°í¸ë²ˆí˜¸ ì¶”ê°€ (ì„ íƒì‚¬í•­)
                if (addr.postcode && addr.postcode.length === 5) {
                  koreanAddress += ` (${addr.postcode})`;
                }
              }
              
              // ì£¼ì†Œê°€ êµ¬ì„±ë˜ì§€ ì•Šì€ ê²½ìš° display_nameì—ì„œ ì¶”ì¶œ
              if (!koreanAddress) {
                koreanAddress = data.display_name || 'ì£¼ì†Œë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤';
                
                // ì˜ë¬¸ ì£¼ì†Œë¥¼ í•œêµ­ì–´ë¡œ ì •ë¦¬
                if (koreanAddress.includes(',')) {
                  const parts = koreanAddress.split(',').map(part => part.trim());
                  // ë’¤ì—ì„œë¶€í„° 7ê°œ ë¶€ë¶„ë§Œ ì‚¬ìš© (ì‹œë„, ì‹œêµ°êµ¬, ìë©´ë™, ë¦¬, ë²ˆì§€, ê±´ë¬¼)
                  const koreanParts = parts.slice(-7).reverse();
                  koreanAddress = koreanParts.join(' ');
                }
              }
              
              // ìµœì†Œí•œì˜ ì£¼ì†Œ í˜•ì‹ ë³´ì¥
              if (!koreanAddress || koreanAddress.length < 10) {
                koreanAddress = `ìœ„ë„ ${lat.toFixed(4)}, ê²½ë„ ${lng.toFixed(4)} ê·¼ì²˜`;
              }
              
              setPosition(prev => ({
                ...prev, 
                address: koreanAddress,
                buildingInfo: buildingInfo,
                addressLoading: false
              }));
              
            } else {
              throw new Error('ì£¼ì†Œ ì¡°íšŒ API ì‘ë‹µ ì˜¤ë¥˜');
            }
          } catch (error) {
            console.error('ì£¼ì†Œ ë³€í™˜ ì˜¤ë¥˜:', error);
            setPosition(prev => ({
              ...prev, 
              address: `ì£¼ì†Œ ì¡°íšŒ ì‹¤íŒ¨ - ìœ„ë„ ${lat.toFixed(4)}, ê²½ë„ ${lng.toFixed(4)} ê·¼ì²˜`,
              addressLoading: false
            }));
          }
        };

        // ì˜¨ë¼ì¸ ìƒíƒœ ê°ì§€
        useEffect(() => {
          const handleOnline = () => setIsOnline(true);
          const handleOffline = () => setIsOnline(false);
          
          window.addEventListener('online', handleOnline);
          window.addEventListener('offline', handleOffline);
          
          return () => {
            window.removeEventListener('online', handleOnline);
            window.removeEventListener('offline', handleOffline);
          };
        }, []);

        // ì‹¤ì œ GPS ìœ„ì¹˜ ê°€ì ¸ì˜¤ê¸°
        const getCurrentPosition = () => {
          if (!navigator.geolocation) {
            setPosition(prev => ({
              ...prev,
              error: 'GPSê°€ ì§€ì›ë˜ì§€ ì•ŠëŠ” ë¸Œë¼ìš°ì €ì…ë‹ˆë‹¤'
            }));
            return;
          }

          const options = {
            enableHighAccuracy: true,
            timeout: 10000,
            maximumAge: 0
          };

          const success = (pos) => {
            const { latitude, longitude, accuracy } = pos.coords;
            const newPosition = {
              latitude: latitude,
              longitude: longitude,
              timestamp: new Date().toLocaleTimeString(),
              accuracy: Math.round(accuracy),
              error: null,
              address: null,
              addressLoading: false
            };
            
            setPosition(newPosition);
            
            // ì£¼ì†Œ ë³€í™˜ (ì˜¨ë¼ì¸ì¼ ë•Œë§Œ)
            if (isOnline) {
              getAddressFromCoordinates(latitude, longitude);
            }
            
            // ìœ„ì¹˜ íˆìŠ¤í† ë¦¬ì— ì¶”ê°€
            setLocationHistory(prev => [...prev, {
              ...newPosition,
              id: Date.now()
            }].slice(-100));
          };

          const error = (err) => {
            let errorMessage = '';
            switch(err.code) {
              case err.PERMISSION_DENIED:
                errorMessage = "ìœ„ì¹˜ ê¶Œí•œì´ ê±°ë¶€ë˜ì—ˆìŠµë‹ˆë‹¤";
                break;
              case err.POSITION_UNAVAILABLE:
                errorMessage = "ìœ„ì¹˜ ì •ë³´ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤";
                break;
              case err.TIMEOUT:
                errorMessage = "ìœ„ì¹˜ ìš”ì²­ ì‹œê°„ì´ ì´ˆê³¼ë˜ì—ˆìŠµë‹ˆë‹¤";
                break;
              default:
                errorMessage = "ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤";
                break;
            }
            setPosition(prev => ({
              ...prev,
              error: errorMessage
            }));
          };

          if (isTracking) {
            setTrackingStartTime(new Date());
            const id = navigator.geolocation.watchPosition(success, error, options);
            setWatchId(id);
          } else {
            setTrackingStartTime(null);
            if (watchId) {
              navigator.geolocation.clearWatch(watchId);
              setWatchId(null);
            }
          }
        };

        useEffect(() => {
          getCurrentPosition();
          
          return () => {
            if (watchId) {
              navigator.geolocation.clearWatch(watchId);
            }
          };
        }, [isTracking]);

        // ì¶”ì  ì‹œê°„ ê³„ì‚°
        const getTrackingDuration = () => {
          if (!trackingStartTime) return '00:00:00';
          const now = new Date();
          const diff = now - trackingStartTime;
          const hours = Math.floor(diff / 3600000);
          const minutes = Math.floor((diff % 3600000) / 60000);
          const seconds = Math.floor((diff % 60000) / 1000);
          return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
        };

        // ì´ë™ ê±°ë¦¬ ê³„ì‚°
        const getTotalDistance = () => {
          if (locationHistory.length < 2) return 0;
          let distance = 0;
          for (let i = 1; i < locationHistory.length; i++) {
            const prev = locationHistory[i-1];
            const curr = locationHistory[i];
            const lat1 = prev.latitude * Math.PI / 180;
            const lat2 = curr.latitude * Math.PI / 180;
            const deltaLat = (curr.latitude - prev.latitude) * Math.PI / 180;
            const deltaLng = (curr.longitude - prev.longitude) * Math.PI / 180;
            
            const a = Math.sin(deltaLat/2) * Math.sin(deltaLat/2) +
                     Math.cos(lat1) * Math.cos(lat2) *
                     Math.sin(deltaLng/2) * Math.sin(deltaLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            distance += 6371000 * c;
          }
          return distance;
        };

        return (
          <div className="min-h-screen bg-gradient-to-br from-green-50 to-blue-50 p-4">
            <div className="max-w-md mx-auto space-y-6">
              
              {/* í—¤ë” */}
              <div className="text-center">
                <h1 className="text-3xl font-bold text-gray-800 mb-2">
                  ğŸŒ¾ ë†ì–´ì´Œ ì´ˆì •ë°€ ì°¨ëŸ‰ ì¶”ì 
                </h1>
                <p className="text-gray-600">í˜¸ìˆ˜Â·ê±´ë¬¼ëª…Â·ì¸µìˆ˜ê¹Œì§€ ì‹¤ì‹œê°„ GPS ëª¨ë‹ˆí„°ë§</p>
              </div>

              {/* ì•Œë¦¼ */}
              <div className="bg-green-50 border border-green-200 rounded-lg p-4">
                <p className="text-green-700 text-sm">
                  ğŸ›°ï¸ <strong>ì´ˆì •ë°€ GPS ì¶”ì  ì‹œìŠ¤í…œ</strong> - ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•˜ë©´ 
                  <strong>í˜¸ìˆ˜, ê±´ë¬¼ëª…, ì¸µìˆ˜ê¹Œì§€</strong> í¬í•¨ëœ ì •í™•í•œ ì£¼ì†Œì™€ í•¨ê»˜ ì¶”ì ì´ ì‹œì‘ë©ë‹ˆë‹¤!
                </p>
              </div>

              {/* ì°¨ëŸ‰ ì •ë³´ */}
              <div className="bg-white border border-gray-200 rounded-lg p-4">
                <h4 className="font-semibold text-gray-800 mb-3">
                  ğŸšœ ì°¨ëŸ‰ ì •ë³´
                </h4>
                
                <div className="space-y-3">
                  <div>
                    <label className="block text-sm font-medium text-gray-700 mb-2">
                      ì°¨ëŸ‰ ì‹ë³„ë²ˆí˜¸:
                    </label>
                    <input
                      type="text"
                      value={vehicleId}
                      onChange={(e) => setVehicleId(e.target.value)}
                      placeholder="ì˜ˆ: ë†ê¸°ê³„001, íŠ¸ë™í„°Aí˜¸, ë§ˆì„ë²„ìŠ¤"
                      className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500"
                    />
                  </div>
                  
                  <div className="flex items-center justify-between">
                    <span className="text-sm text-gray-600">ì—°ê²° ìƒíƒœ:</span>
                    <div className="flex items-center">
                      <div className={`w-3 h-3 rounded-full mr-2 ${isOnline ? 'bg-green-500 tracking-dot' : 'bg-red-500'}`}></div>
                      <span className="text-sm font-medium">
                        {isOnline ? 'ì˜¨ë¼ì¸' : 'ì˜¤í”„ë¼ì¸'}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              {/* GPS ê¶Œí•œ ì•ˆë‚´ */}
              {!isTracking && (
                <div className="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                  <h4 className="font-semibold text-yellow-800 mb-2">
                    ğŸ“± ì´ˆì •ë°€ GPS ì‚¬ìš© ì¤€ë¹„ì‚¬í•­
                  </h4>
                  <ul className="text-yellow-700 text-sm space-y-1">
                    <li>â€¢ ë¸Œë¼ìš°ì €ì—ì„œ <strong>"ìœ„ì¹˜ ê¶Œí•œ í—ˆìš©"</strong> í´ë¦­</li>
                    <li>â€¢ ì‹¤ì™¸ì—ì„œ ì‚¬ìš© ì‹œ ë” ì •í™•í•œ GPS ì‹ í˜¸</li>
                    <li>â€¢ ì˜¨ë¼ì¸ ì—°ê²° ì‹œ <strong>í˜¸ìˆ˜, ê±´ë¬¼ëª…, ì¸µìˆ˜</strong>ê¹Œì§€ í‘œì‹œ</li>
                    <li>â€¢ ë†ì–´ì´Œ ì§€ì—­ì˜ <strong>ìƒê°€, ì•„íŒŒíŠ¸, ê³µê³µê±´ë¬¼</strong> ì •ë³´ í¬í•¨</li>
                  </ul>
                  <div className="mt-2 p-2 bg-yellow-100 rounded text-xs text-yellow-600">
                    ğŸ¯ ë„ì‹œ ìˆ˜ì¤€ì˜ ì •ë°€ ìœ„ì¹˜ ì„œë¹„ìŠ¤ë¥¼ ë†ì–´ì´Œì—ì„œë„!
                  </div>
                </div>
              )}

              {/* ì¶”ì  ì œì–´ */}
              <div className="bg-white rounded-lg p-6 shadow-lg">
                <button
                  onClick={() => setIsTracking(!isTracking)}
                  className={`w-full py-4 px-6 rounded-lg font-semibold text-lg transition-all ${
                    isTracking 
                      ? 'bg-red-500 hover:bg-red-600 text-white' 
                      : 'bg-green-500 hover:bg-green-600 text-white'
                  }`}
                >
                  {isTracking ? 'â¹ï¸ ì¶”ì  ì¤‘ì§€' : 'â–¶ï¸ ì¶”ì  ì‹œì‘'}
                </button>
                
                <div className="mt-4 text-center">
                  <span className={`inline-flex items-center px-3 py-1 rounded-full text-sm ${
                    isTracking 
                      ? 'bg-red-100 text-red-600' 
                      : 'bg-gray-100 text-gray-600'
                  }`}>
                    {isTracking ? 'ğŸ”´ ì‹¤ì‹œê°„ ì¶”ì  ì¤‘' : 'âš« ì¶”ì  ëŒ€ê¸° ì¤‘'}
                  </span>
                </div>
              </div>

              {/* ì¶”ì  í†µê³„ */}
              {isTracking && trackingStartTime && (
                <div className="bg-white rounded-lg p-6 shadow-lg">
                  <h3 className="text-lg font-semibold text-gray-800 mb-4">
                    ğŸ“Š ì¶”ì  í†µê³„
                  </h3>
                  
                  <div className="grid grid-cols-2 gap-4">
                    <div className="text-center p-3 bg-blue-50 rounded-lg">
                      <div className="text-2xl font-bold text-blue-600">{getTrackingDuration()}</div>
                      <div className="text-sm text-blue-500">ì¶”ì  ì‹œê°„</div>
                    </div>
                    <div className="text-center p-3 bg-green-50 rounded-lg">
                      <div className="text-2xl font-bold text-green-600">
                        {Math.round(getTotalDistance())}m
                      </div>
                      <div className="text-sm text-green-500">ì´ë™ ê±°ë¦¬</div>
                    </div>
                    <div className="text-center p-3 bg-purple-50 rounded-lg">
                      <div className="text-2xl font-bold text-purple-600">{locationHistory.length}</div>
                      <div className="text-sm text-purple-500">ìœ„ì¹˜ ê¸°ë¡</div>
                    </div>
                    <div className="text-center p-3 bg-orange-50 rounded-lg">
                      <div className="text-2xl font-bold text-orange-600">
                        {position.accuracy ? `Â±${position.accuracy}m` : 'N/A'}
                      </div>
                      <div className="text-sm text-orange-500">GPS ì •í™•ë„</div>
                    </div>
                  </div>
                </div>
              )}

              {/* í˜„ì¬ ìœ„ì¹˜ ì£¼ì†Œ (í•œêµ­ í‘œì¤€ í˜•ì‹) */}
              {isTracking && position.latitude && (
                <div className="address-box rounded-lg p-6 shadow-lg">
                  <h3 className="text-lg font-semibold text-gray-800 mb-4 text-center">
                    ğŸ“ í˜„ì¬ ìœ„ì¹˜ (í‘œì¤€ í•œêµ­ ì£¼ì†Œ)
                  </h3>
                  
                  {position.addressLoading ? (
                    <div className="text-center">
                      <div className="text-lg text-gray-500">ğŸ” í•œêµ­ í‘œì¤€ ì£¼ì†Œë¥¼ êµ¬ì„± ì¤‘...</div>
                      <div className="mt-2 bg-green-200 rounded-full h-2">
                        <div className="bg-green-500 h-2 rounded-full animate-pulse w-3/4"></div>
                      </div>
                      <div className="text-xs text-gray-400 mt-2 space-y-1">
                        <div>â€¢ ì‹œ/ë„ â†’ ì‹œ/êµ°/êµ¬ â†’ ì/ë©´/ë™</div>
                        <div>â€¢ ë¦¬/ë™ â†’ ë²ˆì§€-í˜¸ â†’ ê±´ë¬¼ëª…</div>
                      </div>
                    </div>
                  ) : position.address ? (
                    <div className="text-center">
                      <div className="text-xl font-bold text-green-700 mb-3 leading-relaxed px-2 break-words">
                        {position.address}
                      </div>
                      <div className="text-sm text-green-600 mb-2">
                        ğŸ“… {new Date().toLocaleDateString('ko-KR')} {position.timestamp}
                      </div>
                      
                      {/* ì£¼ì†Œ êµ¬ì„± ìš”ì†Œ ë¶„ì„ í‘œì‹œ */}
                      <div className="mt-3 p-3 bg-blue-50 rounded-lg border border-blue-200 text-left">
                        <div className="text-sm font-medium text-blue-800 mb-2">ğŸ“‹ ì£¼ì†Œ êµ¬ì„± ìš”ì†Œ</div>
                        <div className="text-xs text-blue-700 space-y-1">
                          {position.address.split(' ').map((part, index) => {
                            let label = '';
                            if (index === 0 && part.includes('ë„')) label = 'ì‹œ/ë„';
                            else if (index === 1 && (part.includes('ì‹œ') || part.includes('êµ°') || part.includes('êµ¬'))) label = 'ì‹œ/êµ°/êµ¬';
                            else if (index === 2 && (part.includes('ë©´') || part.includes('ì') || part.includes('ë™'))) label = 'ì/ë©´/ë™';
                            else if (index === 3 && part.includes('ë¦¬')) label = 'ë¦¬';
                            else if (part.includes('ë²ˆì§€') || part.includes('í˜¸')) label = 'ë²ˆì§€-í˜¸';
                            else if (part.includes('ë§ˆíŠ¸') || part.includes('ì„¼í„°') || part.includes('ë†í˜‘') || part.includes('ì€í–‰')) label = 'ê±´ë¬¼ëª…';
                            
                            return label ? (
                              <div key={index} className="flex justify-between">
                                <span className="text-blue-500">{label}:</span>
                                <span className="font-medium">{part}</span>
                              </div>
                            ) : null;
                          })}
                        </div>
                      </div>
                      
                      <div className="text-xs text-green-500 bg-green-50 rounded-lg p-2 mt-3">
                        ğŸ’¡ ì‹œ/ë„ â†’ ì‹œ/êµ°/êµ¬ â†’ ì/ë©´/ë™ â†’ ë¦¬ â†’ ë²ˆì§€-í˜¸ â†’ ê±´ë¬¼ëª… ìˆœì„œë¡œ êµ¬ì„±
                      </div>
                      
                      {/* í–¥í›„ ê³µê³µë°ì´í„° ì—°ë™ ì•ˆë‚´ */}
                      <div className="mt-3 p-2 bg-purple-50 rounded-lg border border-purple-200">
                        <div className="text-xs text-purple-700">
                          ğŸš€ <strong>í™•ì¥ ê³„íš:</strong> ê³µê³µë°ì´í„° ì—°ë™ìœ¼ë¡œ 
                          <strong>ìƒì„¸ ì¸µìˆ˜, ì‹¤í˜¸ìˆ˜, ì£¼ì°¨êµ¬ì—­</strong>ê¹Œì§€ í‘œì‹œ ì˜ˆì •
                        </div>
                      </div>
                    </div>
                  ) : (
                    <div className="text-center text-gray-500">
                      <div className="text-lg">ğŸï¸ ìœ„ì¹˜ ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ì¤‘...</div>
                      <div className="text-sm mt-1">
                        {isOnline ? 'í•œêµ­ í‘œì¤€ ì£¼ì†Œ ì²´ê³„ë¡œ ì¡°íšŒ ì¤‘' : 'ì˜¤í”„ë¼ì¸ ëª¨ë“œ - ì˜¨ë¼ì¸ ì—°ê²° ì‹œ í‘œì¤€ ì£¼ì†Œ í‘œì‹œ'}
                      </div>
                    </div>
                  )}
                </div>
              )}

              {/* ìƒì„¸ ìœ„ì¹˜ ì •ë³´ (ì ‘ì„ ìˆ˜ ìˆê²Œ) */}
              {isTracking && position.latitude && (
                <details className="location-card rounded-lg shadow-lg">
                  <summary className="p-4 cursor-pointer font-semibold text-gray-800">
                    ğŸ”§ ìƒì„¸ GPS ì •ë³´ (ê°œë°œììš©)
                  </summary>
                  
                  <div className="p-4 pt-0">
                    {position.error ? (
                      <div className="bg-red-50 border border-red-200 rounded-lg p-4">
                        <p className="text-red-600">âŒ {position.error}</p>
                        <p className="text-sm text-red-500 mt-2">
                          ğŸ’¡ ë¸Œë¼ìš°ì €ì—ì„œ ìœ„ì¹˜ ê¶Œí•œì„ í—ˆìš©í•´ì£¼ì„¸ìš”
                        </p>
                      </div>
                    ) : (
                      <div className="space-y-3">
                        <div className="flex justify-between">
                          <span className="text-gray-600">ìœ„ë„:</span>
                          <span className="font-mono text-blue-600 text-sm">
                            {position.latitude.toFixed(6)}Â°
                          </span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-gray-600">ê²½ë„:</span>
                          <span className="font-mono text-blue-600 text-sm">
                            {position.longitude.toFixed(6)}Â°
                          </span>
                        </div>
                        <div className="flex justify-between">
                          <span className="text-gray-600">ì •í™•ë„:</span>
                          <span className="font-mono text-green-600 text-sm">
                            Â±{position.accuracy}m
                          </span>
                        </div>
                        
                        {/* êµ¬ê¸€ ë§µ ë§í¬ */}
                        <div className="mt-4 pt-4 border-t border-blue-200">
                          <a 
                            href={`https://maps.google.com/?q=${position.latitude},${position.longitude}`}
                            target="_blank"
                            rel="noopener noreferrer"
                            className="inline-flex items-center px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors w-full justify-center"
                          >
                            ğŸ—ºï¸ êµ¬ê¸€ë§µì—ì„œ ì •í™•í•œ ìœ„ì¹˜ ë³´ê¸°
                          </a>
                        </div>
                      </div>
                    )}
                  </div>
                </details>
              )}

              {/* ìœ„ì¹˜ íˆìŠ¤í† ë¦¬ */}
              {isTracking && locationHistory.length > 0 && (
                <details className="bg-white rounded-lg shadow-lg">
                  <summary className="p-4 cursor-pointer font-semibold text-gray-800">
                    ğŸ“‹ ìœ„ì¹˜ íˆìŠ¤í† ë¦¬ ({locationHistory.length}ê°œ)
                  </summary>
                  
                  <div className="p-4 pt-0">
                    <div className="max-h-64 overflow-y-auto space-y-2">
                      {locationHistory.slice(-10).reverse().map((loc) => (
                        <div key={loc.id} className="bg-gray-50 rounded-lg p-3 text-sm border">
                          <div className="flex justify-between items-center">
                            <span className="font-mono text-blue-600 text-xs">
                              {loc.latitude.toFixed(4)}Â°, {loc.longitude.toFixed(4)}Â°
                            </span>
                            <span className="text-gray-500 text-xs">{loc.timestamp}</span>
                          </div>
                          <div className="text-xs text-gray-400 mt-1 flex justify-between">
                            <span>ì •í™•ë„: Â±{loc.accuracy}m</span>
                            <span>{isOnline ? 'ğŸŸ¢ ì €ì¥ë¨' : 'ğŸ”´ ë¡œì»¬ë§Œ'}</span>
                          </div>
                        </div>
                      ))}
                    </div>
                    
                    {locationHistory.length > 10 && (
                      <div className="text-center mt-3 text-sm text-gray-500">
                        ìµœê·¼ 10ê°œ í‘œì‹œ (ì „ì²´ {locationHistory.length}ê°œ ê¸°ë¡)
                      </div>
                    )}
                  </div>
                </details>
              )}

              {/* ë†ì–´ì´Œ í™œìš© ì•ˆë‚´ */}
              <div className="bg-gradient-to-r from-green-50 to-blue-50 border border-green-200 rounded-lg p-4">
                <h4 className="font-semibold text-gray-800 mb-2">
                  ğŸŒ¾ í•œêµ­ í‘œì¤€ ì£¼ì†Œ ì²´ê³„ í™œìš© ì‚¬ë¡€
                </h4>
                <div className="text-sm text-gray-700 space-y-2">
                  <div className="p-2 bg-white rounded border-l-4 border-green-400">
                    <strong>ğŸšœ ë†ê¸°ê³„ ê´€ë¦¬:</strong><br/>
                    "ì¶©ì²­ë‚¨ë„ ì˜ˆì‚°êµ° ë•ì‚°ë©´ ìƒë™ë¦¬ 123-32í˜¸ ë†í˜‘ì°½ê³  ì•ì—ì„œ íŠ¸ë™í„° ì‘ì—… ì¤‘"
                  </div>
                  
                  <div className="p-2 bg-white rounded border-l-4 border-blue-400">
                    <strong>ğŸšŒ ë§ˆì„ êµí†µ:</strong><br/>
                    "ê²½ê¸°ë„ ê¹€í¬ì‹œ ëŒ€ê³¶ë©´ ì‹ í‰ë¦¬ 456-7í˜¸ í•˜ë‚˜ë¡œë§ˆíŠ¸ ì •ë¥˜ì¥ì— ë²„ìŠ¤ ë„ì°©"
                  </div>
                  
                  <div className="p-2 bg-white rounded border-l-4 border-purple-400">
                    <strong>ğŸ†˜ ì‘ê¸‰ ìƒí™©:</strong><br/>
                    "ì „ë¼ë‚¨ë„ ê³ í¥êµ° ê³ í¥ì ì„œë¬¸ë¦¬ 789-15í˜¸ ê²½ë¡œë‹¹ ì˜† ë†ë¡œì—ì„œ ì‚¬ê³  ë°œìƒ"
                  </div>
                  
                  <div className="p-2 bg-white rounded border-l-4 border-orange-400">
                    <strong>ğŸ“¦ ë°°ì†¡/íƒë°°:</strong><br/>
                    "ì¶©ì²­ë‚¨ë„ ì˜ˆì‚°êµ° ì˜ˆì‚°ì ëŒ€íšŒë¦¬ 234-8í˜¸ ë†í˜‘ í•˜ë‚˜ë¡œë§ˆíŠ¸ë¡œ ë°°ì†¡ ìš”ì²­"
                  </div>
                  
                  <div className="p-2 bg-white rounded border-l-4 border-red-400">
                    <strong>ğŸ  ë¯¼ë°•/ê´€ê´‘:</strong><br/>
                    "ì¶©ì²­ë‚¨ë„ ì˜ˆì‚°êµ° ë•ì‚°ë©´ ì‚¬ë¦¬ 567-22í˜¸ ë•ì‚°ì˜¨ì²œíœì…˜ Aë™ì—ì„œ ëŒ€ê¸°"
                  </div>
                </div>
                
                <div className="mt-4 p-3 bg-gradient-to-r from-green-100 to-blue-100 rounded-lg">
                  <div className="text-xs text-gray-700 mb-2">
                    ğŸ¯ <strong>í‘œì¤€ ì£¼ì†Œ ì²´ê³„ì˜ ì¥ì :</strong>
                  </div>
                  <div className="text-xs text-gray-600 grid grid-cols-2 gap-2">
                    <div>â€¢ ì „êµ­ ì–´ë””ì„œë‚˜ ì¼ê´€ëœ í˜•ì‹</div>
                    <div>â€¢ ê³µê³µê¸°ê´€ í˜¸í™˜ì„± 100%</div>
                    <div>â€¢ ì‘ê¸‰ì„œë¹„ìŠ¤ ì‹ ì† ëŒ€ì‘</div>
                    <div>â€¢ ë°°ì†¡/íƒë°° ì •í™•í•œ ë°°ë‹¬</div>
                  </div>
                </div>
                
                <div className="mt-3 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                  <div className="text-xs text-yellow-800 mb-2">
                    ğŸš€ <strong>ê³µê³µë°ì´í„° ì—°ë™ í™•ì¥ ê³„íš:</strong>
                  </div>
                  <div className="text-xs text-yellow-700 space-y-1">
                    <p>â€¢ ğŸ¢ <strong>ê±´ë¬¼ ë‚´ë¶€:</strong> "ë†í˜‘ í•˜ë‚˜ë¡œë§ˆíŠ¸ 2ì¸µ ì‚¬ë¬´ì‹¤"</p>
                    <p>â€¢ ğŸ…¿ï¸ <strong>ì£¼ì°¨ ì •ë³´:</strong> "ì§€í•˜1ì¸µ ì£¼ì°¨ì¥ Aêµ¬ì—­ 12ë²ˆ"</p>
                    <p>â€¢ ğŸšª <strong>ì¶œì…êµ¬:</strong> "ë™ë¬¸ ì¶œì…êµ¬, ì„œë¬¸ ì£¼ì°¨ì¥ ì…êµ¬"</p>
                    <p>â€¢ ğŸ“ <strong>ì‹¤ë‚´ ìœ„ì¹˜:</strong> "1ì¸µ ê³ ê°ì„¼í„°, 3ì¸µ íšŒì˜ì‹¤"</p>
                  </div>
                </div>
                
                <div className="mt-3 p-2 bg-green-100 rounded text-xs text-green-700">
                  ğŸ’¡ <strong>ì‹œ/ë„ â†’ ì‹œ/êµ°/êµ¬ â†’ ì/ë©´/ë™ â†’ ë¦¬ â†’ ë²ˆì§€-í˜¸ â†’ ê±´ë¬¼ëª…</strong> ìˆœì„œë¡œ 
                  ì „êµ­ í‘œì¤€ í˜•ì‹ì— ë§ì¶° ì •í™•í•œ ìœ„ì¹˜ ì •ë³´ ì œê³µ!
                </div>
              </div>

            </div>
          </div>
        );
      }

      ReactDOM.render(<RuralVehicleTracker />, document.getElementById('root'));
    </script>
</body>
</html>
